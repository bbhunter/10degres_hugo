<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Gwendal Le Coguic">
    <meta name="description" content="Gwendal Le Coguic, web developer and bug hunter">
    <meta name="keywords" content="development,security,researcher,bugbounty,tools,php,python">

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://10degres.net/assets/img/header-background.jpg"/>

<meta name="twitter:title" content="Vulnerability in Wordpress Video Gallery"/>
<meta name="twitter:description" content="Recently reported by Claudio Viviani, there is an SQL Injection available in this plugin who has been downloaded more than 100k.
Developped by Apptha (again), the current version 2.7 still vulnerable and downloadable from
the official Wordpress Plugin Directory.
The hole comes from the lack of filter on the GET parameter vid in /wp-content/plugins/contus-video-gallery/videogalleryrss.php (the plugin must be enable to perform the injection):
case &#39;video&#39;:
  $thumbImageorder = &#39;w.vid ASC&#39;;
  $vid             = filter_input(INPUT_GET,&#39;vid&#39;);
  $where           = &#39;AND w.vid =&#39;.$vid;
  $TypeOFvideos    = $contusOBJ-&gt;home_thumbdata( $thumbImageorder , $where , $dataLimit );
break;
Since there is no filter specified when calling filter_input, the default value is used which is unsafe_raw.
According to the PHP documentation, FILTER_UNSAFE_RAW deletes chars under 32 and over 127 and converts &amp; to &amp;amp;."/>
<meta name="twitter:site" content="@10degres"/>
<meta name="twitter:creator" content="@gwendallecoguic"/>

    <meta property="og:title" content="Vulnerability in Wordpress Video Gallery" />
<meta property="og:description" content="Recently reported by Claudio Viviani, there is an SQL Injection available in this plugin who has been downloaded more than 100k.
Developped by Apptha (again), the current version 2.7 still vulnerable and downloadable from
the official Wordpress Plugin Directory.
The hole comes from the lack of filter on the GET parameter vid in /wp-content/plugins/contus-video-gallery/videogalleryrss.php (the plugin must be enable to perform the injection):
case &#39;video&#39;:
  $thumbImageorder = &#39;w.vid ASC&#39;;
  $vid             = filter_input(INPUT_GET,&#39;vid&#39;);
  $where           = &#39;AND w.vid =&#39;.$vid;
  $TypeOFvideos    = $contusOBJ-&gt;home_thumbdata( $thumbImageorder , $where , $dataLimit );
break;
Since there is no filter specified when calling filter_input, the default value is used which is unsafe_raw.
According to the PHP documentation, FILTER_UNSAFE_RAW deletes chars under 32 and over 127 and converts &amp; to &amp;amp;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://10degres.net/vulnerability-in-wordpress-video-gallery/" />

<meta property="og:image" content="http://10degres.net/assets/img/header-background.jpg" />
<meta property="article:published_time" content="2015-02-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2015-02-12T00:00:00+00:00" /><meta property="og:site_name" content="10degres" />


    
      <base href="http://10degres.net/vulnerability-in-wordpress-video-gallery/">
    
    <title>
  Vulnerability in Wordpress Video Gallery · 10degres
</title>

    
      <link rel="canonical" href="http://10degres.net/vulnerability-in-wordpress-video-gallery/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="http://10degres.net/assets/css/coder.min.b7c885186d029c262c5580a8cf13937b5dae16dc868972a0c3fdd82752e6cacb.css" integrity="sha256-t8iFGG0CnCYsVYCozxOTe12uFtyGiXKgw/3YJ1Lmyss=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://10degres.net/assets/css/custom.css" />
    

    <link rel="icon" type="image/png" href="http://10degres.net/assets/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://10degres.net/assets/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.91.0" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://10degres.net/">
      10degres
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/cves/">CVEs</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/services/">Services</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/press/">Press</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://10degres.net/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Vulnerability in Wordpress Video Gallery</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2015-02-12T00:00:00Z'>
                February 12, 2015
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              2 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="http://10degres.net/tags/sql-injection/">sql injection</a>
      <span class="separator">•</span>
    <a href="http://10degres.net/tags/video-gallery/">video gallery</a>
      <span class="separator">•</span>
    <a href="http://10degres.net/tags/wordpress/">wordpress</a></div>

        </div>
      </header>

      <div>
        <p>Recently reported by Claudio Viviani, there is an SQL Injection available in this plugin who has been downloaded more than 100k.
Developped by Apptha (again), the current version 2.7 still vulnerable and downloadable from
the official <a href="https://wordpress.org/plugins/contus-video-gallery/" title="Wordpress Video Gallery">Wordpress Plugin Directory</a>.</p>
<p>The hole comes from the lack of filter on the GET parameter <code>vid</code> in <code>/wp-content/plugins/contus-video-gallery/videogalleryrss.php</code> (the plugin must be enable to perform the injection):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;video&#39;</span><span style="color:#f92672">:</span>
  $thumbImageorder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;w.vid ASC&#39;</span>;
  $vid             <span style="color:#f92672">=</span> <span style="color:#a6e22e">filter_input</span>(<span style="color:#a6e22e">INPUT_GET</span>,<span style="color:#e6db74">&#39;vid&#39;</span>);
  $where           <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;AND w.vid =&#39;</span><span style="color:#f92672">.</span>$vid;
  $TypeOFvideos    <span style="color:#f92672">=</span> $contusOBJ<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">home_thumbdata</span>( $thumbImageorder , $where , $dataLimit );
<span style="color:#66d9ef">break</span>;
</code></pre></div><p>Since there is no filter specified when calling <a href="http://php.net/manual/fr/function.filter-input.php" title="filter_input">filter_input</a>, the default value is used which is <code>unsafe_raw</code>.
According to the PHP documentation, <a href="http://php.net/manual/fr/filter.filters.sanitize.php" title="FILTER_UNSAFE_RAW">FILTER_UNSAFE_RAW</a> deletes chars under 32 and over 127 and converts <code>&amp;</code> to <code>&amp;amp;</code>.</p>
<p>Of course, it&rsquo;s not enough to protect the query crafted in <code>/wp-content/plugins/contus-video-gallery/front/models/videohome.php</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">$</span>query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;SELECT distinct w.*,s.guid,s.ID,p.playlist_name,p.pid,p.playlist_slugname FROM &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span>this<span style="color:#f92672">-&gt;</span>_videoinfotable . <span style="color:#e6db74">&#39; w
</span><span style="color:#e6db74">LEFT JOIN &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span>this<span style="color:#f92672">-&gt;</span>_wpdb<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">prefix</span> . <span style="color:#e6db74">&#39;hdflvvideoshare_med2play m ON m.media_id = w.vid
</span><span style="color:#e6db74">LEFT JOIN &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span>this<span style="color:#f92672">-&gt;</span>_wpdb<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">prefix</span> . <span style="color:#e6db74">&#39;hdflvvideoshare_playlist p ON p.pid=m.playlist_id
</span><span style="color:#e6db74">LEFT JOIN &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span>this<span style="color:#f92672">-&gt;</span>_wpdb<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">prefix</span> . <span style="color:#e6db74">&#39;posts s ON s.ID=w.slug
</span><span style="color:#e6db74">WHERE w.publish=1 AND p.is_publish=1 &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#66d9ef">where</span> . <span style="color:#e6db74">&#39; GROUP BY w.vid ORDER BY &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span>thumImageorder . <span style="color:#e6db74">&#39; LIMIT &#39;</span> . <span style="color:#960050;background-color:#1e0010">$</span>dataLimit;
</code></pre></div><p>Rendered as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">distinct</span> w.<span style="color:#f92672">*</span>,s.guid,s.ID,p.playlist_name,p.pid,p.playlist_slugname <span style="color:#66d9ef">FROM</span> wp_hdflvvideoshare w
<span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> wp_hdflvvideoshare_med2play m <span style="color:#66d9ef">ON</span> m.media_id <span style="color:#f92672">=</span> w.vid
<span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> wp_hdflvvideoshare_playlist p <span style="color:#66d9ef">ON</span> p.pid<span style="color:#f92672">=</span>m.playlist_id
<span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> wp_posts s <span style="color:#66d9ef">ON</span> s.ID<span style="color:#f92672">=</span>w.slug
<span style="color:#66d9ef">WHERE</span> w.publish<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">AND</span> p.is_publish<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">AND</span> w.vid <span style="color:#f92672">=</span><span style="color:#ae81ff">234</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> w.vid <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> w.vid <span style="color:#66d9ef">ASC</span> <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1000</span>
</code></pre></div><p>Here is the POC:</p>
<p><img src="http://10degres.net/images/wordpress-video-gallery-sqli.png" alt="wordpress video gallery sqli"></p>
<p>Remember that <strong>it&rsquo;s not the first time that Apptha released a plugin with major vulnerability</strong>. Months ago <a href="http://10degres.net/vulnerability-in-hd-flv-player/" title="HD FLV Player">HD FLV Player</a> was concerned.</p>
<h2 id="external-resources">External resources</h2>
<ul>
<li><a href="http://www.homelab.it/index.php/2015/02/11/wordpress-video-gallery-2-7-sql-injection/">Original post by Claudio Viviani</a></li>
<li><a href="https://www.apptha.com/">Apptha official website</a></li>
</ul>
      </div>

      <footer>
        


      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
    
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-61485350-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
      <script src="http://10degres.net/assets/js/scripts.js"></script>
    
    
  </body>

</html>
